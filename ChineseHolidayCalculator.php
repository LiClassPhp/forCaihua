<?php

/**
 * 中国节假日调休计算器（2023-2026）
 * 用于判断周六、周日是正常周末还是调休上班日
 * 数据来源：国务院办公厅发布的节假日安排通知
 */
class ChineseHolidayCalculator
{
    // 存储调休上班日（即本应休息的周六/日却要上班）
    private $makeupWorkdays = [];

    // 存储法定节假日（放假日期）
    private $holidays = [];

    /**
     * 构造函数：加载2023-2026年的调休数据
     */
    public function __construct()
    {
        $this->load2023Data();
        $this->load2024Data();
        $this->load2025Data();
        $this->load2026Data();
    }

    /**
     * 加载2023年调休数据
     * 来源：国务院办公厅关于2023年部分节假日安排的通知（国办发明电〔2022〕16号）
     * @see https://www.gov.cn/gongbao/content/2023/content_5736714.htm
     */
    private function load2023Data()
    {
        // 2023年调休上班日（周六/日需上班）
        $this->makeupWorkdays = array_merge($this->makeupWorkdays, [
            '2023-01-28', // 1月28日（星期六）上班[reference:0]
            '2023-01-29', // 1月29日（星期日）上班[reference:1]
            '2023-04-23', // 4月23日（星期日）上班[reference:2]
            '2023-05-06', // 5月6日（星期六）上班[reference:3]
            '2023-06-25', // 6月25日（星期日）上班[reference:4]
            '2023-10-07', // 10月7日（星期六）上班[reference:5]
            '2023-10-08', // 10月8日（星期日）上班[reference:6]
        ]);

        // 2023年法定节假日（放假日期）
        $this->holidays = array_merge($this->holidays, [
            // 元旦：2022-12-31 至 2023-01-02
            '2022-12-31', '2023-01-01', '2023-01-02',
            // 春节：1月21日至27日
            '2023-01-21', '2023-01-22', '2023-01-23', '2023-01-24',
            '2023-01-25', '2023-01-26', '2023-01-27',
            // 清明节：4月5日
            '2023-04-05',
            // 劳动节：4月29日至5月3日
            '2023-04-29', '2023-04-30', '2023-05-01', '2023-05-02', '2023-05-03',
            // 端午节：6月22日至24日
            '2023-06-22', '2023-06-23', '2023-06-24',
            // 中秋节、国庆节：9月29日至10月6日
            '2023-09-29', '2023-09-30', '2023-10-01', '2023-10-02', '2023-10-03',
            '2023-10-04', '2023-10-05', '2023-10-06',
        ]);
    }

    /**
     * 加载2024年调休数据
     * 来源：国务院办公厅关于2024年部分节假日安排的通知（国办发明电〔2023〕7号）
     * @see https://www.gov.cn/gongbao/2023/issue_10806/202311/content_6913823.html
     */
    private function load2024Data()
    {
        // 2024年调休上班日
        $this->makeupWorkdays = array_merge($this->makeupWorkdays, [
            '2024-02-04', // 2月4日（星期日）上班[reference:7]
            '2024-02-18', // 2月18日（星期日）上班[reference:8]
            '2024-04-07', // 4月7日（星期日）上班[reference:9]
            '2024-04-28', // 4月28日（星期日）上班[reference:10]
            '2024-05-11', // 5月11日（星期六）上班[reference:11]
            '2024-09-14', // 9月14日（星期六）上班[reference:12]
            '2024-09-29', // 9月29日（星期日）上班[reference:13]
            '2024-10-12', // 10月12日（星期六）上班[reference:14]
        ]);

        // 2024年法定节假日（放假日期）
        $this->holidays = array_merge($this->holidays, [
            // 春节：2月10日至17日
            '2024-02-10', '2024-02-11', '2024-02-12', '2024-02-13', '2024-02-14',
            '2024-02-15', '2024-02-16', '2024-02-17',
            // 清明节：4月4日至6日
            '2024-04-04', '2024-04-05', '2024-04-06',
            // 劳动节：5月1日至5日
            '2024-05-01', '2024-05-02', '2024-05-03', '2024-05-04', '2024-05-05',
            // 端午节：6月10日（与周末连休）
            '2024-06-10',
            // 中秋节：9月15日至17日
            '2024-09-15', '2024-09-16', '2024-09-17',
            // 国庆节：10月1日至7日
            '2024-10-01', '2024-10-02', '2024-10-03', '2024-10-04', '2024-10-05',
            '2024-10-06', '2024-10-07',
        ]);
    }

    /**
     * 加载2025年调休数据
     * 来源：国务院办公厅关于2025年部分节假日安排的通知（国办发明电〔2024〕12号）
     * @see https://www.gov.cn/gongbao/2024/issue_11726/202411/content_6989767.html
     */
    private function load2025Data()
    {
        // 2025年调休上班日
        $this->makeupWorkdays = array_merge($this->makeupWorkdays, [
            '2025-01-26', // 1月26日（周日）上班[reference:15]
            '2025-02-08', // 2月8日（周六）上班[reference:16]
            '2025-04-27', // 4月27日（周日）上班[reference:17]
            '2025-09-28', // 9月28日（周日）上班[reference:18]
            '2025-10-11', // 10月11日（周六）上班[reference:19]
        ]);

        // 2025年法定节假日（放假日期）
        $this->holidays = array_merge($this->holidays, [
            // 春节：1月28日至2月4日
            '2025-01-28', '2025-01-29', '2025-01-30', '2025-01-31',
            '2025-02-01', '2025-02-02', '2025-02-03', '2025-02-04',
            // 清明节：4月4日至6日
            '2025-04-04', '2025-04-05', '2025-04-06',
            // 劳动节：5月1日至5日
            '2025-05-01', '2025-05-02', '2025-05-03', '2025-05-04', '2025-05-05',
            // 端午节：5月31日至6月2日
            '2025-05-31', '2025-06-01', '2025-06-02',
            // 国庆节、中秋节：10月1日至8日
            '2025-10-01', '2025-10-02', '2025-10-03', '2025-10-04', '2025-10-05',
            '2025-10-06', '2025-10-07', '2025-10-08',
        ]);
    }

    /**
     * 加载2026年调休数据
     * 来源：国务院办公厅关于2026年部分节假日安排的通知（国办发明电〔2025〕7号）
     * @see http://big5.www.gov.cn/gate/big5/www.gov.cn/gongbao/2025/issue_12406/202511/content_7048922.html
     */
    private function load2026Data()
    {
        // 2026年调休上班日
        $this->makeupWorkdays = array_merge($this->makeupWorkdays, [
            '2026-01-04', // 1月4日（周日）上班[reference:20]
            '2026-02-14', // 2月14日（周六）上班[reference:21]
            '2026-02-28', // 2月28日（周六）上班[reference:22]
            '2026-05-09', // 5月9日（周六）上班[reference:23]
            '2026-09-20', // 9月20日（周日）上班[reference:24]
            '2026-10-10', // 10月10日（周六）上班[reference:25]
        ]);

        // 2026年法定节假日（放假日期）
        $this->holidays = array_merge($this->holidays, [
            // 元旦：1月1日至3日
            '2026-01-01', '2026-01-02', '2026-01-03',
            // 春节：2月15日至23日
            '2026-02-15', '2026-02-16', '2026-02-17', '2026-02-18', '2026-02-19',
            '2026-02-20', '2026-02-21', '2026-02-22', '2026-02-23',
            // 清明节：4月4日至6日
            '2026-04-04', '2026-04-05', '2026-04-06',
            // 劳动节：5月1日至5日
            '2026-05-01', '2026-05-02', '2026-05-03', '2026-05-04', '2026-05-05',
            // 端午节：6月19日至21日
            '2026-06-19', '2026-06-20', '2026-06-21',
            // 中秋节：9月25日至27日
            '2026-09-25', '2026-09-26', '2026-09-27',
            // 国庆节：10月1日至7日
            '2026-10-01', '2026-10-02', '2026-10-03', '2026-10-04', '2026-10-05',
            '2026-10-06', '2026-10-07',
        ]);
    }

    /**
     * 判断是否为调休上班日（周六/日却要上班）
     * @param string $date 日期（格式：Y-m-d）
     * @return bool
     */
    public function isMakeupWorkday($date)
    {
        return in_array($date, $this->makeupWorkdays);
    }

    /**
     * 判断是否为法定节假日（放假日期）
     * @param string $date 日期（格式：Y-m-d）
     * @return bool
     */
    public function isHoliday($date)
    {
        return in_array($date, $this->holidays);
    }

    /**
     * 判断是否为周末（周六或周日）
     * @param string $date 日期（格式：Y-m-d）
     * @return bool
     */
    public function isWeekend($date)
    {
        $timestamp = strtotime($date);
        $dayOfWeek = date('w', $timestamp); // 0=周日, 1=周一, ..., 6=周六
        return $dayOfWeek == 0 || $dayOfWeek == 6;
    }

    /**
     * 获取日期类型
     * @param string $date 日期（格式：Y-m-d）
     * @return string 返回以下类型之一：
     *   - 'holiday': 法定节假日（放假）
     *   - 'makeup_workday': 调休上班日（本应休息的周六/日却要上班）
     *   - 'normal_weekend': 正常周末（周六/日且不调休）
     *   - 'normal_weekday': 正常工作日（周一至周五且不放假）
     */
    public function getDateType($date)
    {
        if($this->isHoliday($date)){
            return 'holiday';
        }

        if($this->isMakeupWorkday($date)){
            return 'makeup_workday';
        }

        if($this->isWeekend($date)){
            return 'normal_weekend';
        }

        return 'normal_weekday';
    }

    /**
     * 获取所有调休上班日（用于批量处理）
     * @return array
     */
    public function getAllMakeupWorkdays()
    {
        return $this->makeupWorkdays;
    }

    /**
     * 获取所有法定节假日（用于批量处理）
     * @return array
     */
    public function getAllHolidays()
    {
        return $this->holidays;
    }
}